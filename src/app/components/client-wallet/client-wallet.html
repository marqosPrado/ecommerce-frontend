<app-header/>
<main style="padding: 3rem 12rem 4rem 12rem">
  <div style="display: flex; flex-direction: column; margin-bottom: 4rem; gap: 8px;">
    <div style="display: flex; flex-direction: row; align-items: center; gap: 8px;">
      <i class="pi pi-wallet"></i>
      <h2>Minha carteira</h2>
    </div>
    <span>Gerencie seus cartões de crédito ou adicione novos</span>
  </div>

  <div style="display: flex; flex-direction: column; gap: 2rem">
    @if (!showCreditCardForm()) {
      <div style="display: flex; flex-direction: row; justify-content: space-between">
        <h2>Cartões</h2>
        <p-button
          label="ADICIONAR CARTÃO DE CRÉDITO"
          (click)="handleCreditCardForm()"
        />
      </div>
    }

    @if (showCreditCardForm()) {
      <div style="display: flex; flex-direction: column; gap: 1rem">
        <div style="display: flex; flex-direction: row; align-items: center; gap: 8px;">
          <i class="pi pi-plus-circle"></i>
          <h2 style="font-size: 18px">Adicionar novo cartão</h2>
        </div>

        <form style="display: flex; flex-direction: column; gap: 1rem" [formGroup]="creditCardForm">
          <div [style]="{'width': '100%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
            <p-floatlabel variant="on" [style]="{'width': '100%'}">
              <input
                pInputText
                id="city"
                style="width: 100%"
                formControlName="name"
                pSize="large"
              />
              <label for="city">Nome do cartão*</label>
            </p-floatlabel>
            @if (creditCardForm.get('name')?.invalid && creditCardForm.get('name')?.touched) {
              <div class="alert alert-danger">
                @if (creditCardForm.get('name')?.hasError('required')) {
                  <div style="color: #a44b4c;font-size: 0.875rem;">É necessário informar o nome.</div>
                }
              </div>
            }
          </div>

          <div [style]="{'width': '100%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
            <p-floatlabel variant="on" [style]="{'width': '100%'}">
              <input
                pInputText
                id="city"
                style="width: 100%"
                formControlName="printedName"
                pSize="large"
              />
              <label for="city">Nome impresso no cartão*</label>
            </p-floatlabel>
            @if (creditCardForm.get('printedName')?.invalid && creditCardForm.get('printedName')?.touched) {
              <div class="alert alert-danger">
                @if (creditCardForm.get('printedName')?.hasError('required')) {
                  <div style="color: #a44b4c;font-size: 0.875rem;">É necessário informar o nome impresso no cartão.</div>
                }
              </div>
            }
          </div>

          <div style="display: flex; flex-direction: row; width: 100%; gap: 8px">
            <div [style]="{'width': '50%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
              <p-floatlabel variant="on" [style]="{'width': '100%'}">
                <p-inputmask
                  mask="MM/AA"
                  id="validity"
                  size="large"
                  formControlName="validity"
                  [style]="{'width': '100%'}"
                ></p-inputmask>
                <label for="validity">Validade*</label>
              </p-floatlabel>
              @if (creditCardForm.get('validity')?.invalid && creditCardForm.get('validity')?.touched) {
                <div class="alert alert-danger">
                  @if (creditCardForm.get('validity')?.hasError('required')) {
                    <div style="color: #a44b4c;font-size: 0.875rem;">É necessário informar a validade do cartão.</div>
                  }
                </div>
              }
            </div>

            <div [style]="{'width': '50%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
              <p-floatlabel variant="on" [style]="{'width': '100%'}">
                <p-inputmask
                  mask="___"
                  [max]="3"
                  id="verificationCode"
                  size="large"
                  formControlName="verificationCode"
                  [style]="{'width': '100%'}"
                ></p-inputmask>
                <label for="verificationCode">Código de verificação*</label>
              </p-floatlabel>
              @if (creditCardForm.get('verificationCode')?.invalid && creditCardForm.get('verificationCode')?.touched) {
                <div class="alert alert-danger">
                  @if (creditCardForm.get('verificationCode')?.hasError('required')) {
                    <div style="color: #a44b4c;font-size: 0.875rem;">É necessário informar o nome.</div>
                  }
                </div>
              }
            </div>
          </div>

          <h3 style="margin-top: 0.5rem">Dados pessoais</h3>

          <div style="display: flex; flex-direction: row; width: 100%; gap: 8px">
            <div [style]="{'width': '50%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
              <p-floatlabel variant="on">
                <input
                  pInputText
                  class="register-input"
                  id="cpf"
                  pSize="large"
                  formControlName="cpf"
                  [style]="{'width': '100%'}"
                  autocomplete="off"
                  name="cpf"
                  maxlength="11"
                  aria-required="true"
                />
                <label for="cpf">CPF*</label>
              </p-floatlabel>
              @if (creditCardForm.get('cpf')?.invalid && creditCardForm.get('cpf')?.touched) {
                <div class="alert alert-danger">
                  @if (creditCardForm.get('cpf')?.hasError('required')) {
                    <div style="color: #a44b4c;font-size: 0.875rem;">É necessário informar o CPF.</div>
                  }
                </div>
              }
            </div>

            <div [style]="{'width': '50%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
              <p-date-picker
                [showIcon]="true"
                dateFormat="dd/mm/yy"
                formControlName="birthDate"
                placeholder="Data de nascimento*"
                size="large"
                aria-required="true"
              />
              @if (creditCardForm.get('birthDate')?.invalid && creditCardForm.get('birthDate')?.touched) {
                <div class="alert alert-danger">
                  @if (creditCardForm.get('birthDate')?.hasError('required')) {
                    <div style="color: #a44b4c;font-size: 0.875rem;">É necessário informar a data de nascimento.</div>
                  }
                </div>
              }
            </div>
          </div>

          <div style="display: flex; flex-direction: column; gap: 4px; margin-top: 0.5rem">
            <h3>Identificação do cartão:</h3>
            <p>Para facilitar na hora de concluir sua próxima compra, dê um apelido para seu cartão</p>
          </div>

          <div style="display: flex; flex-direction: row; width: 100%; gap: 8px">
            <div [style]="{'width': '100%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
              <p-floatlabel variant="on">
                <input
                  pInputText
                  id="cardSurname"
                  pSize="large"
                  [style]="{'width': '100%'}"
                  name="cardSurname"
                  formControlName="surname"
                  maxlength="20"
                  aria-required="true"
                />
                <label for="cardSurname">Apelido para este cartão*</label>
              </p-floatlabel>
              @if (creditCardForm.get('surname')?.invalid && creditCardForm.get('surname')?.touched) {
                <div class="alert alert-danger">
                  @if (creditCardForm.get('surname')?.hasError('required')) {
                    <div style="color: #a44b4c;font-size: 0.875rem;">É necessário informar um apelido para o cartão.</div>
                  }
                </div>
              }
            </div>
          </div>

          <div class="flex items-center">
            <p-checkbox
              inputId="mainCard"
              formControlName="mainCard"
              [binary]="true">
            </p-checkbox>
            <label for="mainCard" class="ml-2"> Este é meu cartão principal </label>
          </div>

          <div style="display: flex; justify-content: space-between; margin-top: 2rem">
            <p-button label="Voltar para minha conta" variant="outlined" (onClick)="handleCreditCardForm()"/>
            <p-button label="Cadastrar novo cartão" [disabled]="creditCardForm.invalid"/>
          </div>
        </form>
      </div>
    } @else {
      <div style="display: flex; flex-direction: row; gap: 1rem">
        <!--      Colocar for-->
        <p-card
          header="CARTÃO MARCOS"
          [style]="{ width: '25%', height: 'auto', display: 'flex'}"
        >
          <p class="m-0 mb-2">
            444* **** **** 4444
          </p>
          <p class="m-0 mb-2">
            Vence em 08/33
          </p>
          <ng-template #footer>
            <div class="flex gap-4 mt-1">
              <p-button
                label="Remover"
                severity="secondary"
                class="w-full"
                [outlined]="true"
                styleClass="w-full" />
            </div>
          </ng-template>
        </p-card>

        <p-card
          header="CARTÃO MARCOS"
          [style]="{ width: '25%', height: 'auto', display: 'flex'}"
        >
          <p class="m-0 mb-2">
            444* **** **** 4444
          </p>
          <p class="m-0 mb-2">
            Vence em 08/33
          </p>
          <ng-template #footer>
            <div class="flex gap-4 mt-1">
              <p-button
                label="Remover"
                severity="secondary"
                class="w-full"
                [outlined]="true"
                styleClass="w-full" />
            </div>
          </ng-template>
        </p-card>
      </div>
    }
  </div>
</main>
