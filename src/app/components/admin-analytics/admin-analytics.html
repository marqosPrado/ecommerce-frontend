<app-header></app-header>
<app-line-session></app-line-session>

<main style="
  width: 100%;
  min-height: 100vh;
  background: var(--color-surface-darker);
  padding: 4rem 2rem;
  box-sizing: border-box;
">
  <div style="
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 2rem;
  ">
    <!-- Cabeçalho -->
    <section style="
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1rem;
    ">
      <div>
        <h1 style="
          font-size: 1.75rem;
          font-weight: 700;
          color: var(--color-text-primary);
          margin: 0 0 0.5rem 0;
          display: flex;
          align-items: center;
          gap: 0.75rem;
        ">
          <i class="pi pi-chart-line" style="color: var(--color-green);"></i>
          Análise de Vendas
        </h1>
        <p style="
          margin: 0;
          color: var(--color-text-secondary);
          font-size: 0.95rem;
        ">
          Visualize o volume de vendas por período e categoria
        </p>
      </div>

      <button
        pButton
        type="button"
        label="Voltar ao Dashboard"
        icon="pi pi-arrow-left"
        [style]="{
          background: 'transparent',
          border: '1px solid var(--input-border)',
          color: 'var(--color-text-primary)'
        }"
        [routerLink]="['/admin/dashboard']"
      ></button>
    </section>

    <!-- Filtros -->
    <section style="
      background: var(--color-background);
      border: 1px solid var(--input-border);
      border-radius: 12px;
      padding: 2rem;
    ">
      <h3 style="
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--color-text-primary);
        margin: 0 0 1.5rem 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      ">
        <i class="pi pi-filter" style="color: var(--color-blue);"></i>
        Filtros
      </h3>

      <div style="
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 1.5rem;
      ">
        <!-- Data Inicial -->
        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
          <label for="startDate" style="
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--color-text-primary);
          ">
            Data Inicial
          </label>
          <p-datepicker
            inputId="startDate"
            [(ngModel)]="startDate"
            dateFormat="dd/mm/yy"
            [showIcon]="true"
            placeholder="Selecione a data inicial"
            [maxDate]="endDate"
            [style]="{width: '100%'}"
          />
        </div>

        <!-- Data Final -->
        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
          <label for="endDate" style="
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--color-text-primary);
          ">
            Data Final
          </label>
          <p-datepicker
            inputId="endDate"
            [(ngModel)]="endDate"
            dateFormat="dd/mm/yy"
            [showIcon]="true"
            placeholder="Selecione a data final"
            [minDate]="startDate"
            [maxDate]="maxDate"
            [style]="{width: '100%'}"
          />
        </div>

        <!-- Tipo de Filtro -->
        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
          <label for="filterType" style="
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--color-text-primary);
          ">
            Filtrar por
          </label>
          <p-select
            inputId="filterType"
            [(ngModel)]="selectedFilter"
            [options]="filterOptions"
            optionLabel="label"
            optionValue="value"
            placeholder="Selecione o tipo de filtro"
            [style]="{width: '100%'}"
          />
        </div>

        <!-- Botão Buscar -->
        <div style="
          display: flex;
          flex-direction: column;
          justify-content: flex-end;
        ">
          <button
            pButton
            type="button"
            label="Buscar"
            icon="pi pi-search"
            (click)="loadSalesData()"
            [loading]="loading"
            [style]="{
              width: '100%',
              background: 'var(--color-green)',
              border: 'none',
              color: 'white',
              padding: '0.75rem 1.25rem',
              borderRadius: '6px',
              fontWeight: '600',
              cursor: 'pointer'
            }"
          ></button>
        </div>
      </div>

      <!-- Filtros Rápidos -->
      <div style="
        display: flex;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
        padding-top: 1.5rem;
        border-top: 1px solid var(--input-border);
      ">
        <span style="
          font-size: 0.875rem;
          font-weight: 600;
          color: var(--color-text-secondary);
        ">
          Períodos rápidos:
        </span>
        <button
          pButton
          type="button"
          label="Último mês"
          (click)="setLastMonth()"
          [outlined]="true"
          size="small"
          [style]="{
            borderColor: 'var(--input-border)',
            color: 'var(--color-text-primary)',
            background: 'transparent'
          }"
        ></button>
        <button
          pButton
          type="button"
          label="Últimos 3 meses"
          (click)="setLast3Months()"
          [outlined]="true"
          size="small"
          [style]="{
            borderColor: 'var(--input-border)',
            color: 'var(--color-text-primary)',
            background: 'transparent'
          }"
        ></button>
        <button
          pButton
          type="button"
          label="Últimos 6 meses"
          (click)="setLast6Months()"
          [outlined]="true"
          size="small"
          [style]="{
            borderColor: 'var(--input-border)',
            color: 'var(--color-text-primary)',
            background: 'transparent'
          }"
        ></button>
        <button
          pButton
          type="button"
          label="Último ano"
          (click)="setLastYear()"
          [outlined]="true"
          size="small"
          [style]="{
            borderColor: 'var(--input-border)',
            color: 'var(--color-text-primary)',
            background: 'transparent'
          }"
        ></button>
      </div>
    </section>

    <!-- Gráfico -->
    <section style="
      background: var(--color-background);
      border: 1px solid var(--input-border);
      border-radius: 12px;
      padding: 2rem;
    ">
      <div style="margin-bottom: 2rem;">
        <h3 style="
          font-size: 1.25rem;
          font-weight: 600;
          color: var(--color-text-primary);
          margin: 0 0 0.5rem 0;
          display: flex;
          align-items: center;
          gap: 0.5rem;
        ">
          <i class="pi pi-chart-line" style="color: var(--color-green);"></i>
          Volume de Vendas
        </h3>
        @if (hasData) {
          <span style="
            font-size: 0.875rem;
            color: var(--color-text-secondary);
          ">
            Período: {{ formatDate(startDate) }} até {{ formatDate(endDate) }}
          </span>
        }
      </div>

      <!-- Gráfico -->
      @if (!loading && hasData) {
        <div style="
          width: 100%;
          height: 500px;
          background: var(--color-surface-dark);
          border-radius: 8px;
          padding: 1rem;
        ">
          <p-chart
            type="line"
            [data]="salesChartData"
            [options]="salesChartOptions"
            [style]="{
              width: '100%',
              height: '100%'
            }"
          />
        </div>
      }

      <!-- Loading -->
      @if (loading) {
        <div style="
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 4rem 2rem;
          gap: 1rem;
          background: var(--color-surface-dark);
          border-radius: 8px;
        ">
          <i class="pi pi-spin pi-spinner" style="
            font-size: 3rem;
            color: var(--color-green);
          "></i>
          <p style="
            color: var(--color-text-secondary);
            font-size: 1rem;
            margin: 0;
          ">
            Carregando dados...
          </p>
        </div>
      }

      <!-- Sem dados -->
      @if (!loading && !hasData) {
        <div style="
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 4rem 2rem;
          gap: 1rem;
          text-align: center;
          background: var(--color-surface-dark);
          border-radius: 8px;
        ">
          <i class="pi pi-chart-line" style="
            font-size: 4rem;
            color: var(--color-text-muted);
          "></i>
          <h4 style="
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--color-text-primary);
            margin: 0;
          ">
            Nenhum dado encontrado
          </h4>
          <p style="
            color: var(--color-text-secondary);
            font-size: 0.95rem;
            margin: 0;
          ">
            Não há vendas registradas no período selecionado.
          </p>
          <button
            pButton
            type="button"
            label="Tentar outro período"
            icon="pi pi-refresh"
            (click)="setLast3Months()"
            [outlined]="true"
            [style]="{
              marginTop: '1rem',
              borderColor: 'var(--input-border)',
              color: 'var(--color-text-primary)',
              background: 'transparent'
            }"
          ></button>
        </div>
      }
    </section>
  </div>
</main>
