<main style="width: 100%; min-height: 100vh; display: flex; flex-direction: column; padding: 6rem;">
  <!-- Header -->
  <header style="padding: 0 0 1rem 0;">
    <h2 style="margin: 0; display: flex; align-items: center; gap: .5rem;">
      <i class="pi pi-chart-line" style="font-size: 20px;"></i>
      Análises de Compras
    </h2>
    <p style="margin: .25rem 0 0 0; color: var(#6b7280);">
      Dashboard com indicadores, gráficos e filtros interativos.
    </p>
  </header>

  <section style="display: flex; gap: .75rem; flex-wrap: wrap; margin-bottom: 1rem;">
    <p-select
      [options]="periodOptions"
      optionLabel="name"
      optionValue="value"
      [ngModel]="selectedPeriod"
      (ngModelChange)="selectedPeriod = $event; onFiltersChanged()"
      styleClass="w-14rem"
      appendTo="body"
      placeholder="Período">
    </p-select>

    <p-select
      [options]="categoryOptions"
      optionLabel="name"
      optionValue="value"
      [ngModel]="selectedCategory"
      (ngModelChange)="selectedCategory = $event; onFiltersChanged()"
      styleClass="w-16rem"
      appendTo="body"
      placeholder="Categoria">
    </p-select>

    <p-select
      [options]="regionOptions"
      optionLabel="name"
      optionValue="value"
      [ngModel]="selectedRegion"
      (ngModelChange)="selectedRegion = $event; onFiltersChanged()"
      styleClass="w-14rem"
      appendTo="body"
      placeholder="Região">
    </p-select>

    <span style="flex: 1 1 auto;"></span>

    <p-button
      icon="pi pi-download"
      label="Exportar Vendas (CSV)"
      [severity]="'secondary'"
      (onClick)="exportSalesCSV()">
    </p-button>
  </section>

  <section style="margin-bottom: 1rem;">
    <div class="grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem;">
      <p-card class="shadow-2" [style]="{ padding: '1rem' }">
        <div style="display: flex; align-items: center; gap: .75rem;">
          <span class="metric-icon" style="background: linear-gradient(135deg, #3b82f6, #6366f1);">
            <i class="pi pi-shopping-cart"></i>
          </span>
          <div>
            <div style="font-size: 12px; color: var(#6b7280);">Total de compras</div>
            <div style="font-size: 1.25rem; font-weight: 700;">{{ overview.totalPurchases | number }}</div>
          </div>
        </div>
      </p-card>

      <p-card class="shadow-2" [style]="{ padding: '1rem' }">
        <div style="display: flex; align-items: center; gap: .75rem;">
          <span class="metric-icon" style="background: linear-gradient(135deg, #22c55e, #06b6d4);">
            <i class="pi pi-wallet"></i>
          </span>
          <div>
            <div style="font-size: 12px; color: var(#6b7280);">Ticket médio</div>
            <div style="font-size: 1.25rem; font-weight: 700;">R$ {{ overview.avgTicket | number:'1.2-2' }}</div>
          </div>
        </div>
      </p-card>

      <p-card class="shadow-2" [style]="{ padding: '1rem' }">
        <div style="display: flex; align-items: center; gap: .75rem;">
          <span class="metric-icon" style="background: linear-gradient(135deg, #f59e0b, #ef4444);">
            <i class="pi pi-users"></i>
          </span>
          <div>
            <div style="font-size: 12px; color: var(#6b7280);">Clientes ativos</div>
            <div style="font-size: 1.25rem; font-weight: 700;">{{ overview.activeCustomers | number }}</div>
          </div>
        </div>
      </p-card>

      <p-card class="shadow-2" [style]="{ padding: '1rem' }">
        <div style="display: flex; align-items: center; gap: .75rem;">
          <span class="metric-icon" style="background: linear-gradient(135deg, #06b6d4, #3b82f6);">
            <i class="pi pi-refresh"></i>
          </span>
          <div>
            <div style="font-size: 12px; color: var(#6b7280);">Taxa de recompra</div>
            <div style="font-size: 1.25rem; font-weight: 700;">{{ overview.repurchaseRate | number:'1.0-1' }}%</div>
          </div>
        </div>
      </p-card>
    </div>
  </section>

  <!-- Linha 1: Vendas / Categoria -->
  <section class="admin-grid">
    <p-card class="shadow-2 admin-card" [style]="{ padding: '1rem', minHeight: '360px' }">
      <ng-template pTemplate="header">
        <div style="display: flex; align-items: center; gap: .5rem;">
          <i class="pi pi-chart-line"></i>
          <strong>Vendas por Período</strong>
        </div>
      </ng-template>
      <div style="height: 300px;">
        <p-chart type="line" [data]="salesLineData" [options]="salesLineOptions"></p-chart>
      </div>
    </p-card>

    <p-card class="shadow-2 admin-card" [style]="{ padding: '1rem', minHeight: '360px' }">
      <ng-template pTemplate="header">
        <div style="display: flex; align-items: center; gap: .5rem;">
          <i class="pi pi-chart-pie"></i>
          <strong>Distribuição por Categoria</strong>
        </div>
      </ng-template>
      <div style="height: 300px;">
        <p-chart type="doughnut" [data]="categoryDoughnutData" [options]="categoryDoughnutOptions"></p-chart>
      </div>
    </p-card>
  </section>

  <!-- Linha 2: Perfil / Tendências -->
  <section class="admin-grid">
    <p-card class="shadow-2 admin-card" [style]="{ padding: '1rem', minHeight: '360px' }">
      <ng-template pTemplate="header">
        <div style="display: flex; align-items: center; gap: .5rem;">
          <i class="pi pi-sliders-h"></i>
          <strong>Perfil de Clientes</strong>
        </div>
      </ng-template>
      <div style="height: 300px;">
        <p-chart type="bar" [data]="customerProfileBarData" [options]="customerProfileBarOptions"></p-chart>
      </div>
    </p-card>

    <p-card class="shadow-2 admin-card" [style]="{ padding: '1rem', minHeight: '360px' }">
      <ng-template pTemplate="header">
        <div style="display: flex; align-items: center; gap: .5rem;">
          <i class="pi pi-chart-area"></i>
          <strong>Tendências de Produtos</strong>
        </div>
      </ng-template>
      <div style="height: 300px;">
        <p-chart type="line" [data]="trendsStackedAreaData" [options]="trendsStackedAreaOptions"></p-chart>
      </div>
    </p-card>
  </section>

  <!-- Linha 3: Comportamento / Funil -->
  <section class="admin-grid">
    <p-card class="shadow-2 admin-card" [style]="{ padding: '1rem', minHeight: '360px' }">
      <ng-template pTemplate="header">
        <div style="display: flex; align-items: center; gap: .5rem;">
          <i class="pi pi-compass"></i>
          <strong>Análise de Comportamento</strong>
        </div>
      </ng-template>
      <div style="height: 300px;">
        <p-chart type="radar" [data]="behaviorRadarData" [options]="behaviorRadarOptions"></p-chart>
      </div>
    </p-card>

    <p-card class="shadow-2 admin-card" [style]="{ padding: '1rem', minHeight: '360px' }">
      <ng-template pTemplate="header">
        <div style="display: flex; align-items: center; gap: .5rem;">
          <i class="pi pi-filter"></i>
          <strong>Taxa de Conversão</strong>
        </div>
      </ng-template>
      <div style="height: 300px;">
        <p-chart type="bar" [data]="funnelBarData" [options]="funnelBarOptions"></p-chart>
      </div>
    </p-card>
  </section>

  <!-- Insights (opcional) -->
  <section style="margin-top: 1rem;">
    <p-card class="shadow-2" [style]="{ padding: '1rem' }">
      <ng-template pTemplate="header">
        <div style="display: flex; align-items: center; gap: .5rem;">
          <i class="pi pi-lightbulb"></i>
          <strong>Insights automáticos</strong>
        </div>
      </ng-template>
      <p style="margin: 0; color: var(#6b7280);">
        {{ insightMessage }}
      </p>
    </p-card>
  </section>
</main>

<style>
  .admin-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 1rem;
    margin-bottom: 1rem;
  }
  .admin-card {
    border-radius: 12px;
    transition: transform .2s ease, box-shadow .2s ease;
  }
  .admin-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 24px rgba(0,0,0,.08);
  }
  .metric-icon {
    width: 40px; height: 40px;
    display: inline-flex; align-items: center; justify-content: center;
    border-radius: 10px; color: #fff;
  }
  @media (max-width: 640px) {
    main { padding: 1rem; }
  }
</style>
