<app-header></app-header>
<app-line-session></app-line-session>

<main style="width: 100%; height: 100%; padding: 4rem">
  <div style="width: 100%; display: flex; flex-direction: row; gap: 1rem">
    <div style="width: 75%; height: 50%">
      <p-stepper [value]="activeStep" class="basis-[50rem]">
        <p-step-list>
          <p-step [value]="1">Carrinho</p-step>
          @if (activeStep == 2) {
            <p-step [value]="2">Endereços</p-step>
          }
          @if (activeStep >= 3) {
            <p-step [value]="3">Pagamento</p-step>
          }
        </p-step-list>

        <p-step-panels>
          <p-step-panel [value]="1">
              <ng-template #content>
                <div style="display: flex; flex-direction: column; gap: 2rem">
                  <div style="width: 100%; display: flex; justify-content: space-between; align-items: center">
                    <div style="display: flex; gap: 1rem; align-items: center">
                      <i style="font-size: 22px" class="pi pi-shopping-bag"></i>
                      <h2>Produtos e Serviços</h2>
                    </div>

                    @if (cartItems && cartItems.length > 0) {
                      <p-button icon="pi pi-trash" size="large" label="Remover todos os produtos" (onClick)="clearCart()"/>
                    }
                  </div>

                  @if (cartItems && cartItems.length > 0) {
                    @for (item of cartItems; track item.product.id; let i = $index) {
                      <div class="flex flex-col h-48">
                        <div
                          style="display: flex; flex-direction: column; gap: 2rem; border: 1px solid var(--color-background); padding: 1.5rem; border-radius: 10px"
                          class="border-2 border-dashed border-surface-200 dark:border-surface-700 rounded bg-surface-50 dark:bg-surface-950 flex-auto flex justify-center items-center font-medium"
                        >
                          <div style="width: 100%; display: flex;">
                            <div style="width: 60%; max-width: 60%; display: flex; gap: 0.5rem; flex-direction: row;">
                              <img
                                src="{{item.product.images[0]}}"
                                style="width: 120px; height: 120px; object-fit: cover; cursor: pointer; border: 2px solid transparent; border-radius: 5px; transition: border 0.2s;"
                              />

                              <div style="display: flex; flex-direction: column; gap: 0.5rem; padding: 0.5rem">
                                <div style="display: flex; flex-direction: column; gap: 0.3rem">
                                  <span>Orient</span>
                                  <span style="font-weight: bold">{{item.product.title}}</span>
                                </div>

                                <div style="display: flex; flex-direction: column">
                                  <span style="font-size: 12px">Com desconto à vista: <strong>R$ {{item.product.price}}</strong></span>
                                  <span style="font-size: 12px">Parcelado no cartão sem juros: <strong>R$ {{item.product.price}}</strong></span>
                                </div>
                              </div>
                            </div>

                            <form
                              style="width: 20%; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 0.5rem;"
                              [formGroup]="getItemFormGroup(i)">
                              <span>Quant.</span>
                              <p-select
                                [options]="quantityOptions"
                                optionLabel="name"
                                class="w-full md:w-56"
                                [virtualScroll]="true"
                                [virtualScrollItemSize]="7"
                                formControlName="quantity"
                                appendTo="body"
                              />
                              <p-button icon="pi pi-trash" size="small" label="Remover" variant="outlined" (onClick)="removerFromCart(item.product.id)"/>
                            </form>

                            <div style="width: 20%; display: flex; flex-direction: column; justify-content: center; align-items: end">
                              <span>Preço à vista:</span>
                              <span style="font-size: 16px; font-weight: bold">{{item.product.price | currency:'BRL'}}</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    }
                  } @else {
                    <div
                      style="
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        padding: 4rem 2rem;
                        border: 2px dashed var(--input-border);
                        border-radius: 10px;
                        text-align: center;
                        gap: 1.5rem;
                        color: var(--color-text-secondary);
                        background-color: var(--color-surface-dark);
                      "
                    >
                      <i class="pi pi-inbox" style="font-size: 4rem; color: var(--color-text-muted);"></i>
                      <h2 style="color: var(--color-text-primary);">Seu carrinho está vazio!</h2>
                      <p>Parece que você ainda não adicionou nenhum produto à sua sacola de compras.</p>
                      <p-button
                        label="Continuar Comprando"
                        severity="contrast"
                        size="large"
                        icon="pi pi-arrow-left"
                      />
                    </div>
                  }
                </div>
              </ng-template>
          </p-step-panel>

          <p-step-panel [value]="2">
            <ng-template #content>
              <div style="display: flex; flex-direction: column; gap: 0.75rem">
                @if (!showAddressForm) {
                  <div class="flex flex-col h-48">
                    <div
                      class="border-2 border-dashed border-surface-200 dark:border-surface-700 rounded bg-surface-50 dark:bg-surface-950 flex-auto flex justify-center items-center font-medium"
                    >
                      <form style="display: flex; flex-direction: column; gap: 1rem" [formGroup]="addressFormGroup">
                        <span><strong>Selecione seu endereço:</strong></span>

                        @for (addr of addresses; track addr.id) {
                          <div style="display: flex; gap: 0.5rem; border: 1px solid var(--color-background); padding: 1.5rem; border-radius: 10px">
                            <p-radiobutton
                              name="address"
                              [inputId]="'address' + addr.id"
                              formControlName="address"
                              [value]="addr.id"
                            />
                            <label [for]="'address' + addr.id" class="ml-2">{{ addr.street }}, {{ addr.number }} - {{ addr.city }}, {{ addr.stateId }}</label>
                          </div>
                        }
                      </form>
                    </div>
                  </div>
                } @else {
                  <div
                    style="
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        padding: 4rem 2rem;
                        border: 2px dashed var(--input-border);
                        border-radius: 10px;
                        text-align: center;
                        gap: 1.5rem;
                        color: var(--color-text-secondary);
                        background-color: var(--color-surface-dark);
                    ">
                    <form style="display: flex; flex-direction: column; gap: 1rem; width: 100%" [formGroup]="newAddressForm">
                      <div style="display: flex; flex-direction: row; width: 100%; gap: 8px">
                        <div [style]="{'width': '45%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
                          <p-floatlabel variant="on" [style]="{'width': '100%'}">
                            <p-select
                              [options]="[
                                { name: 'Casa', value: 'CASA' },
                                { name: 'Apartamento', value: 'APARTAMENTO' },
                              ]"
                              optionLabel="name"
                              optionValue="value"
                              inputId="typeResidence"
                              formControlName="typeResidence"
                              [style]="{'width': '100%'}"
                              size="large"
                            />
                            <label for="typeResidence">Tipo de residência*</label>
                          </p-floatlabel>
                          @if (newAddressForm.get('typeResidence')?.invalid && newAddressForm.get('typeResidence')?.touched) {
                            <div style="color: #a44b4c; font-size: 0.875rem;">É necessário informar o tipo de residência.</div>
                          }
                        </div>

                        <div [style]="{'width': '55%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
                          <p-select
                            [options]="[
                              {name: 'Rua', value: 'RUA'},
                              {name: 'Avenida', value: 'AVENIDA'},
                              {name: 'Rodovia', value: 'RODOVIA'}
                            ]"
                            optionLabel="name"
                            placeholder="Tipo de Logradouro*"
                            size="large"
                            optionValue="value"
                            formControlName="typePlace"
                            aria-label="Selecione um tipo de logradouro"
                            aria-required="true"
                          />
                          @if (newAddressForm.get('typePlace')?.invalid && newAddressForm.get('typePlace')?.touched) {
                            <div style="color: #a44b4c; font-size: 0.875rem;">É necessário selecionar o tipo de logradouro.</div>
                          }
                        </div>
                      </div>

                      <div style="display: flex; flex-direction: column; width: 100%; gap: 8px">
                        <div [style]="{'width': '100%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
                          <p-floatlabel variant="on" [style]="{'width': '100%'}">
                            <input
                              pInputText
                              style="width: 100%"
                              id="street"
                              formControlName="street"
                              pSize="large"
                            />
                            <label for="street">Logradouro*</label>
                          </p-floatlabel>
                          @if (newAddressForm.get('street')?.invalid && newAddressForm.get('street')?.touched) {
                            <div style="color: #a44b4c; font-size: 0.875rem;">É necessário informar o logradouro.</div>
                          }
                        </div>
                      </div>

                      <div style="display: flex; flex-direction: row; width: 100%; gap: 8px">
                        <div [style]="{'width': '60%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
                          <p-floatlabel variant="on" [style]="{'width': '100%'}">
                            <input
                              pInputText
                              id="district"
                              formControlName="neighborhood"
                              pSize="large"
                              style="width: 100%"
                            />
                            <label for="district">Bairro*</label>
                          </p-floatlabel>
                          @if (newAddressForm.get('neighborhood')?.invalid && newAddressForm.get('neighborhood')?.touched) {
                            <div style="color: #a44b4c; font-size: 0.875rem;">É necessário informar o bairro.</div>
                          }
                        </div>

                        <div [style]="{'width': '40%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
                          <p-floatlabel variant="on" [style]="{'width': '100%'}">
                            <input
                              pInputText
                              id="number"
                              formControlName="number"
                              pSize="large"
                              style="width: 100%"
                            />
                            <label for="number">Número*</label>
                          </p-floatlabel>
                          @if (newAddressForm.get('number')?.invalid && newAddressForm.get('number')?.touched) {
                            <div style="color: #a44b4c; font-size: 0.875rem;">É necessário informar o número.</div>
                          }
                        </div>
                      </div>

                      <div style="display: flex; flex-direction: row; width: 100%; gap: 8px">
                        <div [style]="{'width': '30%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
                          <p-floatlabel variant="on" [style]="{'width': '100%'}">
                            <p-inputmask
                              mask="99999-999"
                              id="cep"
                              formControlName="cep"
                              size="large"
                              [style]="{'width': '100%'}"
                            ></p-inputmask>
                            <label for="cep">CEP*</label>
                          </p-floatlabel>
                          @if (newAddressForm.get('cep')?.invalid && newAddressForm.get('cep')?.touched) {
                            <div style="color: #a44b4c; font-size: 0.875rem;">É necessário informar o CEP.</div>
                          }
                        </div>

                        <div [style]="{'width': '70%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
                          <p-floatlabel variant="on" [style]="{'width': '100%'}">
                            <input
                              pInputText
                              id="city"
                              formControlName="city"
                              style="width: 100%"
                              pSize="large"
                            />
                            <label for="city">Cidade*</label>
                          </p-floatlabel>
                          @if (newAddressForm.get('city')?.invalid && newAddressForm.get('city')?.touched) {
                            <div style="color: #a44b4c; font-size: 0.875rem;">É necessário informar a cidade.</div>
                          }
                        </div>
                      </div>

                      <div style="display: flex; flex-direction: row; width: 100%; gap: 8px">
                        <div [style]="{'width': '50%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
                          <p-select
                            [options]="[
                              {name: 'São Paulo', value: 25},
                              {name: 'Rio de Janeiro', value: 19}
                            ]"
                            optionLabel="name"
                            optionValue="value"
                            placeholder="Estado*"
                            formControlName="stateId"
                            size="large"
                            aria-label="Selecione um estado"
                            aria-required="true"
                          />
                          @if (newAddressForm.get('stateId')?.invalid && newAddressForm.get('stateId')?.touched) {
                            <div style="color: #a44b4c; font-size: 0.875rem;">É necessário selecionar um estado.</div>
                          }
                        </div>

                        <div [style]="{'width': '50%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
                          <p-floatlabel variant="on" [style]="{'width': '100%'}">
                            <input
                              pInputText
                              id="country"
                              formControlName="country"
                              style="width: 100%"
                              pSize="large"
                            />
                            <label for="country">País*</label>
                          </p-floatlabel>
                          @if (newAddressForm.get('country')?.invalid && newAddressForm.get('country')?.touched) {
                            <div style="color: #a44b4c; font-size: 0.875rem;">É necessário informar o país.</div>
                          }
                        </div>
                      </div>

                      <p-floatlabel variant="on" [style]="{'width': '100%'}">
                        <textarea
                          pTextarea
                          id="notes"
                          formControlName="observations"
                          rows="5"
                          [autoResize]="false"
                          style="width: 100%; resize: none"
                        ></textarea>
                        <label for="notes">Observações (opcional)</label>
                      </p-floatlabel>

                      <div style="width: 100%; display: flex; justify-content: center; align-items: center">
                        <p-button
                          severity="primary"
                          size="large"
                          label="Cadastrar endereço"
                          [loading]="loading"
                          (click)="onSubmitNewAddress()"
                        />
                      </div>
                    </form>
                  </div>
                }

                @if (showAddressForm) {
                  <p-button
                    variant="outlined"
                    size="large"
                    (click)="handleAddressForm()"
                  >
                    Cancelar
                  </p-button>
                } @else {
                  <p-button
                    variant="outlined"
                    size="large"
                    (click)="handleAddressForm()"
                  >
                    <i class="pi pi-plus"></i>
                    Cadastrar novo endereço
                  </p-button>
                }
              </div>
            </ng-template>
          </p-step-panel>

          <p-step-panel [value]="3">
            <ng-template #content>
              <div class="flex flex-col h-48" style="display: flex; flex-direction: column; gap: 0.75rem">
                <div
                  class="border-2 border-dashed border-surface-200 dark:border-surface-700 rounded bg-surface-50 dark:bg-surface-950 flex-auto flex justify-center items-center font-medium"
                >
                  @if (!showCreditCardForm) {
                    <span><strong>Selecione seu cartão de créditos:</strong></span>
                    <form style="display: flex; flex-direction: column; padding: 1rem;" [formGroup]="paymentForm">
                      <div style="width: 100%; display: flex; flex-direction: column; gap: 1rem">
                        @for (creditCard of creditCards; track creditCard.id) {
                          <div style="display: flex; flex-direction: column; gap: 0.5rem; padding: 0.5rem 0; border-bottom: 1px solid var(--color-background)">
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                              <div style="display: flex; align-items: center; gap: 0.5rem">
                                @if (creditCard.cardFlag === CreditCardTypes.ELO) {
                                  <img src="/assets/elo.png" width="32" height="32" />
                                } @else if (creditCard.cardFlag === CreditCardTypes.MASTER_CARD) {
                                  <img src="/assets/mastercard.svg" width="32" height="32" alt="mastercard"/>
                                } @else if (creditCard.cardFlag === CreditCardTypes.VISA) {
                                  <img src="/assets/visa.svg" width="32" height="32" alt="visa"/>
                                }

                                <div style="display: flex; flex-direction: column; gap: 0.25rem">
                                  <span>{{ creditCard.printedName }}</span>
                                  <span>{{ creditCard.number }}</span>
                                </div>
                              </div>

                              <p-radiobutton
                                name="creditCard"
                                [value]="creditCard.id"
                                formControlName="creditCardId"
                                [inputId]="'creditCard' + creditCard.id">
                              </p-radiobutton>
                            </div>

                            @if (paymentForm.get('creditCardId')?.value === creditCard.id) {
                              <div style="display: flex; gap: 1rem; align-items: center; padding: 0.5rem 0; width: 100%">
                                <!--                              &lt;!&ndash; CVV &ndash;&gt;-->
                                <!--                              <div style="display: flex; flex-direction: column; gap: 0.25rem; width: 25%;">-->
                                <!--                                <label for="cvv-{{creditCard.id}}">CVV</label>-->
                                <!--                                <input-->
                                <!--                                  pInputText-->
                                <!--                                  id="cvv-{{creditCard.id}}"-->
                                <!--                                  formControlName="securityCode"-->
                                <!--                                  inputmode="numeric"-->
                                <!--                                  pattern="\\d*"-->
                                <!--                                  maxlength="4"-->
                                <!--                                  placeholder="Ex.: 123"-->
                                <!--                                  style="width: 100%;" />-->
                                <!--                                @if (paymentForm.get('securityCode')?.touched && paymentForm.get('securityCode')?.invalid) {-->
                                <!--                                  <small style="color: var(&#45;&#45;color-red)">Informe 3 ou 4 dígitos.</small>-->
                                <!--                                }-->
                                <!--                              </div>-->

                                <div style="display: flex; flex-direction: column; gap: 0.25rem; width: 25%;">
                                  <label for="installments-{{creditCard.id}}">Número de parcelas</label>
                                  <p-select
                                    id="installments-{{creditCard.id}}"
                                    [options]="[
                                      {name: '1x sem juros', value: '1'},
                                      {name: '2x sem juros', value: '2'},
                                      {name: '3x sem juros', value: '3'},
                                      {name: '4x sem juros', value: '4'},
                                      {name: '5x sem juros', value: '5'},
                                      {name: '6x sem juros', value: '6'}
                                    ]"
                                    optionLabel="name"
                                    formControlName="installments"
                                    appendTo="body"
                                    class="w-full md:w-56"
                                  />
                                </div>
                              </div>
                            }
                          </div>
                        }
                      </div>
                    </form>
                  } @else {
                    <div
                      style="
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        padding: 4rem 2rem;
                        border: 2px dashed var(--input-border);
                        border-radius: 10px;
                        text-align: center;
                        gap: 1.5rem;
                        color: var(--color-text-secondary);
                        background-color: var(--color-surface-dark);
                      "
                    >
                      <form style="display: flex; flex-direction: column; gap: 1rem; width: 100%" [formGroup]="newCreditCardForm">
                        <div [style]="{'width': '100%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
                          <p-floatlabel variant="on">
                            <p-inputmask
                              mask="9999 9999 9999 9999"
                              id="number"
                              [style]="{width: '100%'}"
                              [unmask]="true"
                              size="large"
                              placeholder="0000 0000 0000 0000"
                              formControlName="number"
                              aria-required="true"
                            ></p-inputmask>
                            <label for="number">Número do cartão*</label>
                          </p-floatlabel>
                          @if (newCreditCardForm.get('number')?.invalid && newCreditCardForm.get('number')?.touched) {
                            <div style="color: #a44b4c; font-size: 0.875rem;">É necessário informar o número do cartão.</div>
                          }
                        </div>

                        <div style="width: 100%; display: flex; gap: 1rem">
                          <div [style]="{'width': '50%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
                            <p-floatlabel variant="on" [style]="{'width': '100%'}">
                              <input
                                pInputText
                                id="printedName"
                                style="width: 100%"
                                formControlName="printedName"
                                pSize="large"
                              />
                              <label for="printedName">Nome impresso no cartão*</label>
                            </p-floatlabel>
                            @if (newCreditCardForm.get('printedName')?.invalid && newCreditCardForm.get('printedName')?.touched) {
                              <div style="color: #a44b4c; font-size: 0.875rem;">É necessário informar o nome impresso no cartão.</div>
                            }
                          </div>

                          <div [style]="{'width': '50%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
                            <p-floatlabel variant="on">
                              <p-select
                                [options]="[
                                  { name: 'Visa', value: 'VISA' },
                                  { name: 'Mastercard', value: 'MASTER_CARD' },
                                  { name: 'American Express', value: 'AMERICAN_EXPRESS' },
                                  { name: 'Elo', value: 'ELO' },
                                  { name: 'Hipercard', value: 'HIPERCARD' }
                                ]"
                                optionLabel="name"
                                inputId="cardFlag"
                                optionValue="value"
                                size="large"
                                formControlName="cardFlag"
                                style="width: 100%"
                                aria-required="true"
                              />
                              <label for="cardFlag">Bandeira do cartão*</label>
                            </p-floatlabel>
                            @if (newCreditCardForm.get('cardFlag')?.invalid && newCreditCardForm.get('cardFlag')?.touched) {
                              <div style="color: #a44b4c; font-size: 0.875rem;">É necessário selecionar a bandeira do cartão.</div>
                            }
                          </div>
                        </div>

                        <div style="display: flex; flex-direction: row; width: 100%; gap: 8px">
                          <div [style]="{'width': '100%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
                            <p-floatlabel variant="on" [style]="{'width': '100%'}">
                              <p-inputmask
                                mask="999"
                                id="securityCode"
                                size="large"
                                formControlName="securityCode"
                                [style]="{'width': '100%'}"
                              ></p-inputmask>
                              <label for="securityCode">Código de verificação*</label>
                            </p-floatlabel>
                            @if (newCreditCardForm.get('securityCode')?.invalid && newCreditCardForm.get('securityCode')?.touched) {
                              <div style="color: #a44b4c; font-size: 0.875rem;">É necessário informar o código de verificação.</div>
                            }
                          </div>
                        </div>

                        <h3 style="margin-top: 0.5rem">Dados pessoais</h3>

                        <div style="display: flex; flex-direction: row; width: 100%; gap: 8px">
                          <div [style]="{'width': '50%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
                            <p-floatlabel variant="on">
                              <p-inputmask
                                mask="999.999.999-99"
                                id="cpf"
                                [unmask]="true"
                                size="large"
                                formControlName="cpf"
                                [style]="{'width': '100%'}"
                                placeholder="000.000.000-00"
                                aria-required="true"
                              ></p-inputmask>
                              <label for="cpf">CPF*</label>
                            </p-floatlabel>
                            @if (newCreditCardForm.get('cpf')?.invalid && newCreditCardForm.get('cpf')?.touched) {
                              <div style="color: #a44b4c; font-size: 0.875rem;">É necessário informar o CPF.</div>
                            }
                          </div>

                          <div [style]="{'width': '50%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
                            <p-date-picker
                              [showIcon]="true"
                              dateFormat="dd/mm/yy"
                              placeholder="Data de nascimento*"
                              size="large"
                              formControlName="birthDate"
                              aria-required="true"
                            />
                            @if (newCreditCardForm.get('birthDate')?.invalid && newCreditCardForm.get('birthDate')?.touched) {
                              <div style="color: #a44b4c; font-size: 0.875rem;">É necessário informar a data de nascimento.</div>
                            }
                          </div>
                        </div>

                        <div style="display: flex; flex-direction: column; gap: 4px; margin-top: 0.5rem">
                          <h3>Identificação do cartão:</h3>
                          <p>Para facilitar na hora de concluir sua próxima compra, dê um apelido para seu cartão</p>
                        </div>

                        <div style="display: flex; flex-direction: row; width: 100%; gap: 8px">
                          <div [style]="{'width': '100%', 'display': 'flex', 'flex-direction': 'column', 'gap': '8px'}">
                            <p-floatlabel variant="on">
                              <input
                                pInputText
                                id="cardSurname"
                                pSize="large"
                                formControlName="surname"
                                [style]="{'width': '100%'}"
                                name="cardSurname"
                                maxlength="20"
                                aria-required="true"
                              />
                              <label for="cardSurname">Apelido para este cartão*</label>
                            </p-floatlabel>
                            @if (newCreditCardForm.get('surname')?.invalid && newCreditCardForm.get('surname')?.touched) {
                              <div style="color: #a44b4c; font-size: 0.875rem;">É necessário informar um apelido para o cartão.</div>
                            }
                          </div>
                        </div>

                        <div class="flex items-center">
                          <p-checkbox
                            inputId="mainCard"
                            formControlName="isMain"
                            [binary]="true">
                          </p-checkbox>
                          <label for="mainCard" class="ml-2"> Este é meu cartão principal </label>
                        </div>

                        <div style="display: flex; justify-content: space-between; margin-top: 2rem">
                          <p-button
                            label="Cadastrar novo cartão"
                            [loading]="loading"
                            (click)="onSubmitNewCreditCard()"
                          />
                        </div>
                      </form>
                    </div>
                  }
                </div>
                @if (showCreditCardForm) {
                  <p-button
                    variant="outlined"
                    size="large"
                    (click)="handleCreditCardForm()"
                  >
                    Cancelar
                  </p-button>
                } @else {
                  <p-button
                    variant="outlined"
                    size="large"
                    (click)="handleCreditCardForm()"
                  >
                    <i class="pi pi-plus"></i>
                    Cadastrar novo cartão de crédito
                  </p-button>
                }
              </div>
            </ng-template>
          </p-step-panel>
        </p-step-panels>
      </p-stepper>
    </div>

    <div style="width: 25%; padding: 1rem; display: flex; flex-direction: column; gap: 4rem">
      <div style="display: flex; gap: 0.5rem; align-items: center;">
        <i class="pi pi-file" style="font-size: 22px" ></i>
        <h2>Resumo</h2>
      </div>

      <div style="display: flex; flex-direction: row; justify-content: space-between">
        <span style="font-size: 14px">Valores dos produtos</span>
        <span><strong>{{ totalPrice$ | async | currency:'BRL' }}</strong></span>
      </div>

      <div style="width: 100%; display: flex; gap: 0.5rem; margin-top: 1rem; flex-direction: column; align-items: center">
        <p-button
          [label]="activeStep === 3 ? 'Finalizar' : 'Próximo'"
          [icon]="activeStep === 3 ? 'pi pi-check' : 'pi pi-arrow-right'"
          iconPos="right"
          size="large"
          [style]="{width: '100%'}"
          (onClick)="activeStep === 3 ? null : nextStep()"
          [disabled]="primaryDisabled"
        />

        <p-button
          label="Voltar"
          severity="secondary"
          icon="pi pi-arrow-left"
          size="large"
          [style]="{width: '100%'}"
          (onClick)="previousStep()"
          [disabled]="activeStep === 1"
        />
      </div>
    </div>
  </div>
</main>
